name: 丘뙖잺 Actualizar Listas IPTV y EPG

on:
  # 1. Ejecuci칩n programada: cada 2 horas
  schedule:
    - cron: '0 */2 * * *'
  
  # 2. Ejecuci칩n manual: permite ejecutarlo desde la pesta침a "Actions"
  workflow_dispatch:

# Permisos necesarios para que la Action pueda desplegar en GitHub Pages
permissions:
  contents: read
  pages: write
  id-token: write

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest
    
    steps:
      # --- 1. Configuraci칩n Inicial ---
      
      - name: 拘勇 Descargar el c칩digo del repositorio
        uses: actions/checkout@v4

      - name: 游냀 Configurar Python 3.10
        uses: actions/setup-python@v4
        with:
          python-version: '3.10'
          cache: 'pip' # Cachear dependencias para instalaciones m치s r치pidas

      - name: 游닍 Instalar dependencias de Python
        run: |
          pip install -r requirements.txt
          
      # --- 2. Ejecuci칩n del Script ---
      
      - name: 游 Ejecutar el script de Python
        run: |
          python process_streams.py
          
      # --- 3. Generar info.json ---
      
      - name: 游닇 Generar info.json con las URLs de GitHub Pages
        run: |
          echo '{' > info.json
          echo '  "m3u_url": "https://${{ github.repository_owner }}.github.io/${{ github.event.repository.name }}/${{ env.OUTPUT_M3U_FILE }}",' >> info.json
          echo '  "json_url": "https://${{ github.repository_owner }}.github.io/${{ github.event.repository.name }}/${{ env.OUTPUT_JSON_FILE }}",' >> info.json
          echo '  "xmltv_url": "https://${{ github.repository_owner }}.github.io/${{ github.event.repository.name }}/${{ env.OUTPUT_XMLTV_FILE }}"' >> info.json
          echo '}' >> info.json
        env:
          # Hacemos que los nombres de archivo del script de Python est칠n disponibles aqu칤
          OUTPUT_M3U_FILE: "filtered.m3u"
          OUTPUT_JSON_FILE: "epg.json"
          OUTPUT_XMLTV_FILE: "epg.xml"

      # --- 4. Despliegue en GitHub Pages ---
      
      - name: 拘勇 Subir artefactos para GitHub Pages
        uses: actions/upload-pages-artifact@v3
        with:
          # Subir los 4 archivos generados
          path: |
            filtered.m3u
            epg.json
            epg.xml
            info.json

      - name: 游 Desplegar en GitHub Pages
        id: deployment
        uses: actions/deploy-pages@v4
